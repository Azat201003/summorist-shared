syntax = "proto3";

option go_package = "github.com/Azat201003/summorist-shared/gen/go/mores;mores";
package mores;

service Mores {
  // Get list of metas by filter
  rpc GetFiltered(Meta) returns (stream Meta);
  // Downloading by parts, if you have permissions
  rpc DownloadMore(DownloadRequest) returns (stream Part);
  // Uploading new more or updating that exists, if you have permissions
  rpc UploadMore(stream UploadRequest) returns (Meta);
  // Removing more(mark as removed), if you have permissions, returns meta of deleted more
  rpc RemoveMore(RemoveRequest) returns (Meta);
}

message Meta {
  string title = 1;
  uint64 creator_id = 2;
  uint64 more_id = 3;
}

message ExchangeData {  
  uint32 count = 1;
  uint32 size = 2;
  string jwt_token = 3;
}

message DownloadRequest {
  Meta meta = 1;
  ExchangeData data = 2;
  bool converted = 3;
}

message UploadRequest {
  oneof request {
    Part part = 1;
    ExchangeData data = 2;
  }
}

message RemoveRequest {
    Meta meta = 1;
    string jwt_token = 2;
}

message Part {
  uint32 number = 1;
  uint32 size = 2;
  bytes data = 3;
}

